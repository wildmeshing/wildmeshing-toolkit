<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<!-- BEGIN opengraph metadata -->
<meta property="og:title" content="Wildmeshing" />
<meta property="og:description" content="Fast robust meshing." />
<meta property="og:url" content="https://wildmeshing.github.io" />
<!-- END opengraph metadata -->
<title>Wildmeshing Toolkit: Code Structure and Manual</title>
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- https://tholman.com/github-corners/ -->
<a href="https://wildmeshing.github.io" class="github-corner" title="View source on GitHub">
    <svg viewBox="0 0 250 250" width="40" height="40" style="position: absolute; top: 0; border: 0; right: 0; z-index: 99;" aria-hidden="true">
    <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="favicon.ico"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Wildmeshing Toolkit
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Code Structure and Manual </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_docs_main"></a> The wildmeshing toolkit provides a set of algorithms and corresponding data structure for supporting the creation, editing, and optimization of meshes in 2D and 3D. It is designed to support algorithms that that manipulate data on a mesh whose connectivity is changing such asadaptive refinement, shape optimization, or multi-material mesh optimization.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Key Concepts</h1>
<ol type="1">
<li><em>Attributes store per-simplex data.</em> This includes the connectivity <code><a class="el" href="_attribute_8hpp.html">Attribute.hpp</a></code>.</li>
<li><em>Tuples.</em> A tuple <code><a class="el" href="_tuple_8hpp.html">Tuple.hpp</a></code> identifies a "position" on the mesh that can be used for navigation. It is the only way to public interface for accessing attributes. Indices of simplices are purposedly hiddern and not accessible to the public API.</li>
<li><em>Checkpointing.</em> The library supports checkpointing to implement convenient operation rollback at any point during an operation.</li>
<li><em>Invariants.</em> Mesh invariants <code><a class="el" href="_invariant_8hpp.html">Invariant.hpp</a></code> (such as non-inversion) are automatically checked after each operation and the operation is rolled back if it does not satisfy the invariants.</li>
<li><em>Topological Navigation.</em> The library directly supports topological navigation using a tuple, and standard topological operators (star, link, order, etc) in a dimension independent manner <code><a class="el" href="_simplex_collection_8hpp.html">SimplexCollection.hpp</a></code>. Efficient replacement for the most common operations is also supported to improve performance for common operations.</li>
<li><em>Multi Mesh.</em> The library supports embedding of lower-dimensional manifold meshes <code>MultiMeshManager.hpp</code>, and provides a mechanism to update them as local operations are applied to either the background mesh or the embedded ones.</li>
<li><em>Optimization.</em> The library can automatically minimize, through a combination of smooth (vertex relocation) and discrete (split,collapse,swap) operations, a differentiable energy specified on any of its simplices <code><a class="el" href="_function_8hpp.html">Function.hpp</a></code>.</li>
</ol>
<h1><a class="anchor" id="autotoc_md2"></a>
Data Structure</h1>
<p>The toolkit implements an abstract interface <code><a class="el" href="_mesh_8hpp.html">Mesh.hpp</a></code>, which supports simplicial meshes of dimension 0 to 3. The navigation is dimension agnostic and based on a <code><a class="el" href="_tuple_8hpp.html">Tuple.hpp</a></code>. We currently implement this interface for 4 simplicial mesh types: <code><a class="el" href="_point_mesh_8hpp.html">PointMesh.hpp</a></code>, <code><a class="el" href="_edge_mesh_8hpp.html">EdgeMesh.hpp</a></code>, <code>TriangleMesh.hpp</code>, and <code><a class="el" href="_tet_mesh_8hpp.html">TetMesh.hpp</a></code>.</p>
<p>Internally, the data structure is stored as:</p><ul>
<li>A vector of data for each mesh, dimension of simplex, and type of attribute. The vector contains one attribute (vector-)value per simplex of that single dimension (note that each simplex has thus a unique global index, which is its position in this vector).</li>
<li>The connectivity attributes are matinained as standard attributes.</li>
</ul>
<p>For connectivity, for a $d$-simplicial complex we store, for each $d$-simplex, the $d$-simplex and its neighbours (TT for tet, FF for tri) connected through d-1 faces as well as its faces (TF,TE,TV for tet, FE,FV for tri), and one representative for the inverse relationships (for a triangle mesh, every vertex stores the index of one of its incident triangles, and every edge also stores an index of one of the incident triangles). Note that we use only indices internally, but we <b>do not expose</b> this information on purpose to avoid the temptation to use indices in user code (which might be invalidated by local operations).</p>
<p>(TODO: diagrams)</p>
<p>The data structure is not allowed to dynamically resize during local operations: it is responsability of the user to reserve enough memory before attempting to modify a mesh with local operations. Unused memory can be reclaimed by using the function <code>consolidate</code>. If you are using multimesh use <code>multimesh::consolidate</code> (perhaps the other consolidate should not be publicly available).</p>
<h2><a class="anchor" id="autotoc_md3"></a>
Tuple</h2>
<p>A <code><a class="el" href="classwmtk_1_1_tuple.html">wmtk::Tuple</a></code> is our primitive for navigating a mesh, and represents a set of $d+1$ simplices on a $d$-simplicial complex. These simplices are all faces of one another, one per dimension, and if we select $d$ simplices from a tuple there is at most $1$ other tuple that uses those same $d$ simplices, so navigation is performed by "switching" one of the simplices. It is internally represented as a single global index for the $d$-simplex, and a collection of local indices identifying the local faces (for a triangle mesh, the tuple points to the triangle, and it has two local indices to identify the vertex and edge). Navigation is performed by either accessing an adjency topological relation to move to a different top simplex, or by changing the local indices. The change in local indexes is tabulated at <code>local_switch_tuple.hpp</code>, making the navigation efficient. The table is generated with the scripts in the autogen folder.</p>
<h1><a class="anchor" id="autotoc_md4"></a>
Repository Structure</h1>
<p>The main classes in the toolkit are:</p>
<ol type="1">
<li>Mesh <code><a class="el" href="_mesh_8hpp.html">Mesh.hpp</a></code>. It stores a set of attributes and allows navigation and execution of operations. The types of meshes supported are: points (<code><a class="el" href="_point_mesh_8hpp.html">PointMesh.hpp</a></code>), edges (<code><a class="el" href="_edge_mesh_8hpp.html">EdgeMesh.hpp</a></code>), triangles (<code><a class="el" href="_tri_mesh_8hpp.html">TriMesh.hpp</a></code>) and tetrahedra (<code><a class="el" href="_tet_mesh_8hpp.html">TetMesh.hpp</a></code>).</li>
<li>Tuple <code><a class="el" href="_tuple_8hpp.html">Tuple.hpp</a></code>. A tuple is a ordered set of simplices, containing one simplex for each dimension. It allows navigation by using switch operations, see <a href="https://dl.acm.org/doi/10.1145/73833.73858">Representing geometric structures in d dimensions: topology and order</a>.</li>
<li>Simplex <code><a class="el" href="_simplex_8hpp.html">Simplex.hpp</a></code>. A simplex uniquely identifies a simplex in a mesh, and it is internally implemented as a primitive type and a tuple. A collection of simplexes can be stored in a <code><a class="el" href="_simplex_collection_8hpp.html">SimplexCollection.hpp</a></code>. The operations that return collection of simplexes are: <code><a class="el" href="boundary_8hpp.html">boundary.hpp</a></code>, <code><a class="el" href="closed__star_8hpp.html">closed_star.hpp</a></code>, <code><a class="el" href="link_8hpp.html">link.hpp</a></code>, <code><a class="el" href="open__star_8hpp.html">open_star.hpp</a></code>.</li>
<li>An accessor <code><a class="el" href="_accessor_8hpp.html">Accessor.hpp</a></code> allows to access the attributes of the mesh.</li>
</ol>
<h2><a class="anchor" id="autotoc_md5"></a>
attribute — Management of Mesh Attributes, Caching, and Checkpoints</h2>
<p>The attribute management system has the following functionalities:</p><ul>
<li>Support for per-simplex attributes</li>
<li>Automatic serialization</li>
<li>Checkpointing to restore the state of the mesh after a failed operation</li>
<li>Safe access to attributes only through a tuple (no index access is exposed)</li>
</ul>
<p>The key concepts are:</p><ul>
<li><b>Attributes</b>. Attributes are indexed by type (i.e double/char/long/Rational), simplex dimension, attribute id, and finally an additional index for vector type. This nested hierarchy is represented by the following nested classes: AttributeManager (type), MeshAttributes (simplex dimension), Attribute (attribute index), and vector&lt;T&gt; (final index).</li>
<li><b>Handles</b>. They represent pointers to an entity. There are two types of handles, those that represent Attributes and those that demark the existence of a Scope (in database terms a transaction). Handles can be obtained from the mesh class after an attribute is registered using the <code>register_attribute method.</code></li>
<li><code>**Accessors**. They enable safe access to an attribute. A handle can be used to request an accessor using the function</code>get_accessor<code>of the mesh. There are two types of them,</code>Const<code>and</code>Mutable<code>. The mutable one is automatically casted to a const one if necessary.</code></li>
<li><code>**Scopes**. Each attribute is accessed with respect to a scope (transaction). If a scope is marked as failed then all changes made during that scope's lifetime is deleted. It is possible to have no scope where data is permanently saved and it is possible to view the mesh from a scope by using the</code>parent_scope` function in the Mesh class. These scopes are handled by the AttributeManager class.</li>
</ul>
<h3><a class="anchor" id="autotoc_md6"></a>
Public interface description:</h3>
<ol type="1">
<li>Register a new attribute. Mesh-&gt;register_attribute. This function returns a handle.</li>
<li>Mesh-&gt;create_accessor. Converts the handle into an accessor</li>
<li>Access the attribute within the accessor using <code>vector_attribute</code> using a <code>Tuple</code> or <code>Simplex</code>. <code>scalar_attribute</code> can also be used if the attribute only contains a single value.</li>
</ol>
<h3><a class="anchor" id="autotoc_md7"></a>
Private API development details:</h3>
<p>The inclusion tree for storing attributes is: AttributeManager (type), MeshAttributes (simplex dimension), Attribute (simplex index), and vector&lt;T&gt; (final index). The actual data is stored in Attribute as a flat STL vector strided for vector-type attributes.</p>
<p>The inheritance for accessing attributes is: AccessorBase -&gt; CachingAccessor -&gt; Accessor The first two are private, the last is public. AccessorBase provides basic index-based access. CachingAccessor adds a layer on top supporting the use of an intermediate cache to store the changes temporarily. Tuple accessor hides the index access in favor of using a tuple.</p>
<p>The scoping mechanics is complex but entirely hidden by the Accessor interface. Every attribute stores a stack of scopes <code>PerThreadAttributeScopeStacks&lt;T&gt;</code>. A <code>PerThreadAttributeScopeStacks</code> is a wrapper for a <code>AttributeScopeStack</code>. An <code>AttributeScopeStack</code> is a stack of changes not yet applied to a Attribute. Each change is an <code>AttributeScope</code>, which inherits from an <code>AttributeCache</code> to provide the functionality to support a stack. The <code>AttributeCache</code> stores an <code>AttributeCacheData</code>, which stores the actual diff of the modifications done on the attribute.</p>
<h2><a class="anchor" id="autotoc_md8"></a>
autogen — Automatic Generation of Connectivity Tables</h2>
<p>This folder stores a set of scripts that generate navigation tables for the local navigation inside a simplex.</p>
<h2><a class="anchor" id="autotoc_md9"></a>
function — Interfaces and implementations of functions for optimization</h2>
<p>The <code><a class="el" href="_function_8hpp.html">Function.hpp</a></code> provides a generic interface for representing functiosn that might be passed into an optimization scheme, but the majority of our use cases are minimizing "energies" whose degrees of freedom are vertices but their values are defined on a top-dimension simplex, like an integral over triangles on a triangle mesh using barycentric interpolation. We therefore have an interface for defining <code>PerSimplexFunction</code>s that evaluate an energy on a single simplex, but can be differentiated with respect to an attribute stored on a different simplex.</p>
<ul>
<li><code>PerSimplexFunction</code> provides an interface for defining a function evaluated on a simplex, and whose gradient / hessian can be defined with respect to an attribute stored on faces/cofaces of the simplex.</li>
<li><code>LocalNeighborhoodSumFunction.hpp</code> provides a sort of <code>Function</code> that is evaluated in the neighborhood of a target simple so that we can evaluate the full derivative of a variable that affects the evaluation of a function on a set of neighboring simplices. For instance, when evaluating a function on triangles using barycentric interpolation the gradient of a vertex with respect to a per-triangle energy is the sum of the gradients of any triangle coface of the vertex.</li>
</ul>
<p>The <code>simplex</code> folder contains multiple functions that use these interfaces.</p>
<p>TODO: Refactor in progress</p>
<h2><a class="anchor" id="autotoc_md10"></a>
invariants</h2>
<p>A <code><a class="el" href="namespacewmtk.html#aedc5944c76b67357bbdf8174977cf37c">wmtk::Invariant</a></code> is a condition that can be test before <code><a class="el" href="classwmtk_1_1invariants_1_1_invariant.html#ae43f95bda332585aa73a8fd0624a39d3">wmtk::Invariant::before</a></code> or after <code><a class="el" href="classwmtk_1_1invariants_1_1_invariant.html#aeb4f932816cd79ab4591db6808f6446a">wmtk::Invariant::after</a></code> an operation. If the condition is not satisfied, the operation is either not executed, or rolled back. An invariant can be applied to a simplex of any dimension, and should not rely on the before and after functions being called in order. Example of common invariants are checking for a triangle inversion <code>wmtk::TriangleInersionInvariant</code> or limiting the size of an edge <code><a class="el" href="namespacewmtk.html#a9b637b9518a13236e035ca3ea465fd08">wmtk::MinEdgeLengthInvariant</a></code>. Invariants are associated with operations at runtime: each operation stores a collection of invariants <code>wmtk::TupleOperation::invariants</code>.</p>
<h2><a class="anchor" id="autotoc_md11"></a>
io</h2>
<p>TODO: Explain how to load and save a mesh, and specify the hdf5 format</p>
<h2><a class="anchor" id="autotoc_md12"></a>
multimesh</h2>
<p>TODO</p>
<h2><a class="anchor" id="autotoc_md13"></a>
operations</h2>
<p>TODO:</p>
<p>TODO: refactor in progress</p>
<h2><a class="anchor" id="autotoc_md14"></a>
optimization</h2>
<p>TODO: refactor in progress</p>
<h2><a class="anchor" id="autotoc_md15"></a>
simplex</h2>
<p>This folder contains a set of functions to extract and process simplicial meshes. A <code>wmtk::Simplex</code> is internally represented as a <code><a class="el" href="classwmtk_1_1_tuple.html">wmtk::Tuple</a></code> and the simplex type <code><a class="el" href="namespacewmtk.html#af11e67c10a0ab2b57b9bbc3998b62345">wmtk::PrimitiveType</a></code>. The functions supported are: <code><a class="el" href="closed__star_8hpp.html">closed_star.hpp</a></code>, <code><a class="el" href="cofaces__single__dimension_8hpp.html">cofaces_single_dimension.hpp</a></code>, <code><a class="el" href="faces_8hpp.html">faces.hpp</a></code>, <code><a class="el" href="link_8hpp.html">link.hpp</a></code>, <code><a class="el" href="open__star_8hpp.html">open_star.hpp</a></code>, <code><a class="el" href="top__dimension__cofaces_8hpp.html">top_dimension_cofaces.hpp</a></code>. We refer to <a href="https://core.ac.uk/download/pdf/82717779.pdf">P.L. Homeomorphic Manifolds are Equivalent by Elementary Shellingst</a> for the formal definition. These functions also have an iterable version (i.e. <code><a class="el" href="closed__star__iterable_8hpp.html">closed_star_iterable.hpp</a></code>), which should be used when possible, as it avoids unnecessary memory allocations.</p>
<h2><a class="anchor" id="autotoc_md16"></a>
utils</h2>
<p>Contains the logger (<code><a class="el" href="_logger_8hpp.html">Logger.hpp</a></code>), the rational number type (<code><a class="el" href="_rational_8hpp.html">Rational.hpp</a></code>) and additional minor utilities. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
<script type="text/javascript">
  $(function() {
    toggleButton = document.createElement('doxygen-awesome-dark-mode-toggle')
    toggleButton.title = "Toggle Light/Dark Mode"
    $(document).ready(function(){
      document.getElementById("MSearchBox").parentNode.appendChild(toggleButton)
    })
    // every resize will remove the button, which is why it has to be added again:
    $(window).resize(function(){
      document.getElementById("MSearchBox").parentNode.appendChild(toggleButton)
    })
  })
</script>
</body>
</html>
